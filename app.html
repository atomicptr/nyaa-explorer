<!doctype html>
<title>nyaa-explorer</title>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="author" content="Christopher Kaster" />

<link href="lib/bootstrap-3.1.1/css/bootstrap.min.css" rel="stylesheet" />
<link href="style/main.css" rel="stylesheet" />

<!-- navbar -->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="#">nyaa-explorer</a>
		</div>

		<div class="collapse navbar-collapse">
			<div class="col-sm-3 col-md-3 navbar-left">
				<form class="navbar-form" role="search">
					<div class="input-group">
						<input type="text" class="form-control" placeholder="Search" id="search-field" />
						<div class="input-group-btn">
							<button class="btn btn-success" type="button" id="search-btn"><i class="glyphicon glyphicon-search"></i></button>
						</div>
					</div>
				</form>
			</div>
		
			<!-- TODO: readd later
			<ul class="nav navbar-nav navbar-right">
				<li><a href="#">Settings</a></li>
			</ul>-->
		</div>
	</div>
</div>

<!-- body -->
<div class="container">
	<div class="content">
		<div id="tlist" class="list-group">
		</div>
	</div>
</div>

<script src="lib/jquery-2.1.1.js"></script>
<script src="lib/bootstrap-3.1.1/js/bootstrap.min.js"></script>
<script src="nyaa.js"></script>
<script>
	var search_options = {
		base_url: URL_NYAA,
		query: undefined
	};

	$("#search-field").keydown(function(e) {
		if(e.keyCode == 13) {
			e.preventDefault();
			$("#search-btn").click();
			return true;
		}
	});
	
	$("#search-btn").click(function() {
		var raw_tags = $("#search-field").val();
		
		var tags = raw_tags.split(' ');
		
		search_options.query = tags;
		
		refresh();
	});
	
	$(document).ready(function() {
		refresh();
	});
	
	function refresh() {
		nyaa_fetch(0, search_options, function(items) {
			$("#tlist").empty();
			items.forEach(insert_list_item);
		});
	}
	
	function insert_list_item(item) {
		var trusted_item = item.trusted ? " list-group-item-success" : "";
		$("#tlist").append("<a class='list-group-item" + trusted_item + "' href='" + item.download_link + "'><span class='badge alert-danger'>37</span><span class='badge alert-success'>13</span>" + item.title + "</a>");
	}
</script>